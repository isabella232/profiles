(self.webpackChunkprofiles_dev=self.webpackChunkprofiles_dev||[]).push([[2485],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return d}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(n),d=i,h=m["".concat(s,".").concat(d)]||m[d]||u[d]||r;return n?a.createElement(h,o(o({ref:t},c),{},{components:n})):a.createElement(h,o({ref:t},c))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},918:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return c},default:function(){return m}});var a=n(2122),i=n(9756),r=(n(7294),n(3905)),o=["components"],l={sidebar_position:1},s="Installing with GitOps",p={unversionedId:"installer-docs/installing-via-gitops",id:"installer-docs/installing-via-gitops",isDocsHomePage:!1,title:"Installing with GitOps",description:"Environment setup",source:"@site/docs/installer-docs/installing-via-gitops.md",sourceDirName:"installer-docs",slug:"/installer-docs/installing-via-gitops",permalink:"/docs/installer-docs/installing-via-gitops",editUrl:"https://github.com/weaveworks/profiles/edit/main/userdocs/profiles.dev/docs/installer-docs/installing-via-gitops.md",version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Versioning",permalink:"/docs/author-docs/versioning"},next:{title:"Configuring values",permalink:"/docs/installer-docs/setting-values"}},c=[{value:"Environment setup",id:"environment-setup",children:[]},{value:"Simple install from a profile URL",id:"simple-install-from-a-profile-url",children:[]},{value:"Further configurations",id:"further-configurations",children:[]},{value:"The <code>git-repository</code> flag",id:"the-git-repository-flag",children:[{value:"When to use the <code>--git-repository</code> flag",id:"when-to-use-the---git-repository-flag",children:[]}]}],u={toc:c};function m(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"installing-with-gitops"},"Installing with GitOps"),(0,r.kt)("h2",{id:"environment-setup"},"Environment setup"),(0,r.kt)("p",null,"To install profiles with GitOps you will need to have completed the following environment setup."),(0,r.kt)("p",null," \u2705 ",(0,r.kt)("a",{parentName:"p",href:"/docs/tutorial-basics/setup#kubernetes-cluster"},"Cluster")),(0,r.kt)("p",null," \u2705 ",(0,r.kt)("a",{parentName:"p",href:"/docs/tutorial-basics/setup#pctl-the-profiles-cli"},"Pctl binary")),(0,r.kt)("p",null," \u2705 ",(0,r.kt)("a",{parentName:"p",href:"/docs/tutorial-basics/setup#profiles-crds-and-flux-crds"},"Profiles CRDs and Flux CRDs")),(0,r.kt)("p",null," \u2705 ",(0,r.kt)("a",{parentName:"p",href:"/docs/tutorial-basics/setup#a-github-repo-synced-to-flux"},"GitHub repo")),(0,r.kt)("p",null," \u2705 ",(0,r.kt)("a",{parentName:"p",href:"/docs/tutorial-basics/setup#personal-access-token"},"GitHub token")),(0,r.kt)("p",null,"The full setup docs can be found ",(0,r.kt)("a",{parentName:"p",href:"/docs/tutorial-basics/setup#prerequisites"},"here"),"."),(0,r.kt)("h2",{id:"simple-install-from-a-profile-url"},"Simple install from a profile URL"),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Private repos")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If either your GitOps repo or the repo containing the profile you wish to install\nare private, remember to ensure that your local git environment is configured correctly."))),(0,r.kt)("p",null,"To install a profile, we use ",(0,r.kt)("inlineCode",{parentName:"p"},"pctl install"),". To see all flags available on this subcommand,\nsee ",(0,r.kt)("a",{parentName:"p",href:"/docs/pctl/pctl-install-cmd"},"the help"),"."),(0,r.kt)("p",null,"There are two methods by which you can install a profile: with a direct URL and via a catalog.\nPlease see ",(0,r.kt)("a",{parentName:"p",href:"/docs/installer-docs/using-catalogs"},"the page here")," for specific instructions on how to install a profile from a catalog."),(0,r.kt)("p",null,"With the following command, ",(0,r.kt)("inlineCode",{parentName:"p"},"pctl")," will:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"generate a set of manifests for each artifact declared in the profile at the given URL"),(0,r.kt)("li",{parentName:"ul"},"commit those manifests to a branch in your GitOps repo"),(0,r.kt)("li",{parentName:"ul"},"push that branch and"),(0,r.kt)("li",{parentName:"ul"},"open a PR on your GitOps repo to merge the changes.\nYour GitOps repo is the one you synced to Flux in your cluster in the\n",(0,r.kt)("a",{parentName:"li",href:"/docs/tutorial-basics/setup#a-github-repo-synced-to-flux"},"environment setup"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pctl install \\\n  --profile-url <URL of profile to install> \\\n  --create-pr \\\n  --pr-repo <gitops repo username or orgname>/<gitops repo name>\n")),(0,r.kt)("p",null,"Above we use the following flags:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--profile-url"),". This is the full git URL of the profile you wish to install on your cluster."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--create-pr"),". This directs ",(0,r.kt)("inlineCode",{parentName:"li"},"pctl")," to open a PR against the main branch of your GitOps repo.\n",(0,r.kt)("em",{parentName:"li"},"Note that this flag is only supported for GitHub.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--pr-repo"),". The partial URL of your GitOps repo synced to your cluster, in the format\n",(0,r.kt)("inlineCode",{parentName:"li"},"username/repo-name")," (or ",(0,r.kt)("inlineCode",{parentName:"li"},"org-name/repo-name"),").")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"We recommended also setting the ",(0,r.kt)("inlineCode",{parentName:"p"},"--git-repository")," flag. See ",(0,r.kt)("a",{parentName:"p",href:"#the-git-repository-flag"},"below"),"\nfor more information."))),(0,r.kt)("p",null,"Once you have run the command, navigate to your GitOps repo and approve and merge the PR.\nFlux will then sync the new files and the profile will be applied to your cluster."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"When installing a profile via its URL (i.e. when using the ",(0,r.kt)("inlineCode",{parentName:"p"},"--profile-url")," flag)\nremember to check where the profile's ",(0,r.kt)("inlineCode",{parentName:"p"},"profile.yaml")," file is located within\nthe profile's source repository."),(0,r.kt)("p",{parentName:"div"},"Once discovered, you can set the relative path to this file using the ",(0,r.kt)("inlineCode",{parentName:"p"},"--profile-path")," flag."))),(0,r.kt)("h2",{id:"further-configurations"},"Further configurations"),(0,r.kt)("p",null,"You can pass further arguments to ",(0,r.kt)("inlineCode",{parentName:"p"},"pctl install")," for more control over the format\nand destination of your PR. For example, the following command will:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"generate the profile manifests in the ",(0,r.kt)("inlineCode",{parentName:"li"},"ethel")," directory within my GitOps repo"),(0,r.kt)("li",{parentName:"ul"},"set the objects to be deployed in the ",(0,r.kt)("inlineCode",{parentName:"li"},"two-sugars-please")," namespace in my cluster"),(0,r.kt)("li",{parentName:"ul"},"commit to a branch called ",(0,r.kt)("inlineCode",{parentName:"li"},"add-aunt-ethels-profile")),(0,r.kt)("li",{parentName:"ul"},"push that branch to the ",(0,r.kt)("inlineCode",{parentName:"li"},"jammy-dodger")," remote"),(0,r.kt)("li",{parentName:"ul"},"open a PR against the ",(0,r.kt)("inlineCode",{parentName:"li"},"tea-time")," branch in my target GitOps repo")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pctl install \\\n  --profile-url https://github.com/weaveworks/nginx-profile \\\n  --create-pr \\\n  --pr-repo drwho/thirteen \\\n  --out ethel \\\n  --namespace two-sugars-please \\\n  --pr-branch add-aunt-ethels-profile \\\n  --pr-remote jammy-dodger \\\n  --pr-base tea-time\n")),(0,r.kt)("p",null,"To see all flags available on this subcommand, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/pctl/pctl-install-cmd"},"the help"),"."),(0,r.kt)("h2",{id:"the-git-repository-flag"},"The ",(0,r.kt)("inlineCode",{parentName:"h2"},"git-repository")," flag"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"While not required, it is recommended to always set the ",(0,r.kt)("inlineCode",{parentName:"p"},"--git-repository")," flag.\nThis flag is needed by the majority of artifact types, so it may be easier to always\nset it rather than have to discover whether a profile requires it."),(0,r.kt)("p",{parentName:"div"},"Keep reading for instructions on how to set this option."))),(0,r.kt)("p",null,"This flag is required for installing profiles with local resources.\nA local resource is any profile artifact which refers to manifests stored within the profile\nrepository. You can see ",(0,r.kt)("a",{parentName:"p",href:"/docs/author-docs/local-helm-chart"},"this page")," from the author docs as an example."),(0,r.kt)("p",null,"In order to install profiles with local resources, you must provide ",(0,r.kt)("inlineCode",{parentName:"p"},"pctl")," with information\nabout your GitOps repo (very meta, I know)."),(0,r.kt)("p",null,"First, look up the ID of the ",(0,r.kt)("inlineCode",{parentName:"p"},"GitRepository")," resource connected to your repo. (This is\nwhat Flux uses internally to keep things up to date between the repo and the cluster.)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# replace GITOPS_REPO with the name of your GitOps repository\n\nkubectl get gitrepositories.source.toolkit.fluxcd.io -A | awk '/GITOPS_REPO/ {print $1\"/\"$2}'\n")),(0,r.kt)("p",null,"This should return something like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# namespace/name\nflux-system/flux-system\n")),(0,r.kt)("p",null,"Then add the following flag to your ",(0,r.kt)("inlineCode",{parentName:"p"},"install")," command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"--git-repository <output from the command above>\n")),(0,r.kt)("h3",{id:"when-to-use-the---git-repository-flag"},"When to use the ",(0,r.kt)("inlineCode",{parentName:"h3"},"--git-repository")," flag"),(0,r.kt)("p",null,"As a general rule, we recommended always setting this flag, but if you're curious to find out\nyou can navigate to the repository of the profile and look at the ",(0,r.kt)("inlineCode",{parentName:"p"},"profile.yaml"),".\nIn this file you will find a list of ",(0,r.kt)("inlineCode",{parentName:"p"},"artifacts"),". Those which have local resources can be identified\nwith one of the following keys:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"chart.path")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"kustomize.path"))),(0,r.kt)("p",null,"If the list of artifacts includes any ",(0,r.kt)("inlineCode",{parentName:"p"},"profile.source")," keys,\nthese may point to other profiles which themselves could contain local resources."),(0,r.kt)("p",null,"Profile authors may also note in their documentation that their profile contains\nlocal resources, but this should not be relied upon."))}m.isMDXComponent=!0}}]);